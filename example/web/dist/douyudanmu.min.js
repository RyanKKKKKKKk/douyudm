!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=4)}([function(module,exports){module.exports={URL:"wss://danmuproxy.douyu.com:8506/",HEARBEAT_INTERVAL:45,MSG_LIVE_ON:"\u4e3b\u64ad\u6b63\u5728\u76f4\u64ad",MSG_LIVE_OFF:"\u4e3b\u64ad\u6ca1\u6709\u76f4\u64ad",MSG_ROOM_RSS:"\u623f\u95f4\u5f00\u64ad\u63d0\u9192",MSG_BC_BUY_DESERVE:"\u8d60\u9001\u916c\u52e4\u901a\u77e5",MSG_SSD:"\u8d85\u7ea7\u5f39\u5e55",MSG_ROOM_SPBC:"\u623f\u95f4\u5185\u793c\u7269\u5e7f\u64ad"}},function(module,exports,__webpack_require__){function BufferCoder(){this.buffer=new ArrayBuffer(0),this.decoder=new TextDecoder,this.encoder=new TextEncoder,this.littleEndian=!0,this.readLength=0}__webpack_require__(9),BufferCoder.prototype.concat=function(){const arr=[];for(let n=0;n<arguments.length;n++)arr[n]=arguments[n];return arr.reduce(function(arr,buf){const message=buf instanceof ArrayBuffer?new Uint8Array(buf):buf,t=new Uint8Array(arr.length+message.length);return t.set(arr,0),t.set(message,arr.length),t},new Uint8Array(0))},BufferCoder.prototype.decode=function(buf,callback,LE){for(LE=LE||this.littleEndian,this.buffer=this.concat(this.buffer,buf).buffer;this.buffer&&this.buffer.byteLength>0;){if(0===this.readLength){if(this.buffer.byteLength<4)return;this.readLength=new DataView(this.buffer).getUint32(0,LE),this.buffer=this.buffer.slice(4)}if(this.buffer.byteLength<this.readLength)return;const str=this.decoder.decode(this.buffer.slice(8,this.readLength-1));this.buffer=this.buffer.slice(this.readLength),this.readLength=0,callback(str)}},BufferCoder.prototype.encode=function(str,LE){LE=LE||this.littleEndian;let message=this.concat(this.encoder.encode(str),Uint8Array.of(0)),len=8+message.length,r=new DataView(new ArrayBuffer(len+4)),offset=0;return r.setUint32(offset,len,LE),offset+=4,r.setUint32(offset,len,LE),offset+=4,r.setInt16(offset,689,LE),offset+=2,r.setInt8(offset,0),offset+=1,r.setInt8(offset,0),offset+=1,new Uint8Array(r.buffer).set(message,offset),r.buffer},BufferCoder.prototype.blob2ab=function(blob){return new Promise((resolve,reject)=>{let reader=new FileReader;reader.onload=function(e){resolve(e.target.result)},reader.readAsArrayBuffer(blob)})},BufferCoder.prototype.ab2blob=function(ab){return new Blob([ab])},module.exports=new BufferCoder},function(module,exports){function isType(p,type){return Object.prototype.toString.call(p).slice(8,-1).toLocaleLowerCase()===type.toLocaleLowerCase()}function escape(value){return value=(value=(value=value.toString()).replace(/@/g,"@A")).replace(/\//g,"@S")}module.exports={isType:isType,serialize:function serialize(data){if(isType(data,"object")){let str="";for(let[key,value]of Object.entries(data))str+=`${escape(serialize(key))}@=${escape(serialize(value))}/`;return str}return isType(data,"array")?data.map(value=>`${escape(serialize(value))}/`).join(""):isType(data,"string")||isType(data,"number")?data.toString():""},deserialize:function deserialize(raw){const result={};if(isType(result,"undefined")||raw.length<=0)return result;let arr=raw.split("/");for(let i=arr.length-2;i>=0;i--){let item=arr[i].split("@="),k=item[0],v=item[1];/^\w+@A=(.*?)@S$/.test(v)&&(v=deserialize(v.toString().replace(/@A/g,"@").replace(/@S/g,"/"))),result[k]=v}return result}}},function(module,exports,__webpack_require__){"use strict";const douyudanmu=__webpack_require__(5);douyudanmu.stt=__webpack_require__(2),module.exports=douyudanmu},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var douyudm__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),douyudm__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(douyudm__WEBPACK_IMPORTED_MODULE_0__);!function(){var room=null,isConn=!1;function getId(el){return document.getElementById(el)}getId("s").onclick=function(){var roomId=getId("roomId").value;roomId&&roomId>0?(isConn&&(room.logout(),isConn=!1),getId("tips").innerText="",function(roomId){(room=new douyudm__WEBPACK_IMPORTED_MODULE_0___default.a(roomId)).on("connect",function(){}),room.on("disconnect",function(){}),room.on("error",function(err){}),room.on("chatmsg",function(res){}),room.on("loginres",function(res){}),room.on("uenter",function(res){}),room.on("dgb",function(res){res.gfid}),room.run()}(roomId)):getId("tips").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u623f\u95f4\u53f7"},getId("messages").style.height=document.documentElement.clientHeight-60+"px"}()},function(module,exports,__webpack_require__){const websocket=__webpack_require__(6),config=__webpack_require__(0),event=__webpack_require__(8),stt=__webpack_require__(2),bufferCoder=__webpack_require__(1),messageEvent=__webpack_require__(11);module.exports=class{constructor(roomId){this.roomId=roomId,this.ws=null,this.heartbeatTask=null,this.messageEvent=messageEvent,this.ignore=[],this.clientEvent={connect:{name:"open",listener:event.open},disconnect:{name:"close",listener:event.close},error:{name:"error",listener:event.error}}}initSocket(){this.ws=new websocket(config.URL),this.ws.on("open",this.clientEvent.connect.listener.bind(this)),this.ws.on("error",this.clientEvent.error.listener.bind(this)),this.ws.on("close",this.clientEvent.disconnect.listener.bind(this)),this.ws.on("message",event.message.bind(this))}send(message){this.ws.send(bufferCoder.encode(stt.serialize(message)))}getMessage(data){return new Promise((resolve,reject)=>{bufferCoder.decode(data,e=>{resolve(stt.deserialize(e))})})}login(){this.send({type:"loginreq",roomid:this.roomId})}joinGroup(){this.send({type:"joingroup",rid:this.roomId,gid:0})}heartbeat(){this.heartbeatTask=setInterval(()=>{this.send({type:"mrkl"})},1e3*config.HEARBEAT_INTERVAL)}logout(){this.send({type:"logout"}),clearInterval(this.heartbeatTask),this.ws.close()}run(){this.initSocket()}setIgnore(key,value){if(stt.isType(key,"object"))for(let i in key)key[i]&&this.ignore.push(i);else value&&this.ignore.push(key);return this}on(method,callback){let clientEventName=Object.keys(this.clientEvent).find(clientEvent=>clientEvent===method.toLocaleLowerCase());if(clientEventName){if("connect"===clientEventName){let cb=callback;callback=function(res){this.login(),this.joinGroup(),this.heartbeat(),cb.bind(this)(res)}}else if("disconnect"===clientEventName){let cb=callback;callback=function(res){this.logout(),cb.bind(this)(res)}}this.clientEvent[method].listener=callback.bind(this)}Object.keys(this.messageEvent).find(messageEvent=>messageEvent===method.toLocaleLowerCase())&&(this.messageEvent[method]=callback.bind(this))}}},function(module,exports,__webpack_require__){var isBrowser=!1;"undefined"!=typeof window&&(isBrowser=!0);module.exports=isBrowser?class{constructor(address){this.listener={},this.socket=new WebSocket(address)}get CONNECTING(){return WebSocket.CONNECTING}get CLOSING(){return WebSocket.CLOSING}get CLOSED(){return WebSocket.CLOSED}get OPEN(){return WebSocket.OPEN}get readyState(){return this.socket.readyState}get binaryType(){return this.socket.binaryType}get bufferedAmount(){return this.socket.bufferedAmount}get extensions(){return this.socket.extensions}send(data){this.socket.send(data)}close(code,reason){this.socket.close(code,reason)}on(method,callback){let eventName=["open","error","close","message"].find(event=>event===method.toLocaleLowerCase());eventName&&(Object.keys(this.listener).includes(eventName)&&this.socket.removeEventListener(eventName,this.listener[eventName]),this.listener[eventName]=callback,this.socket.addEventListener(eventName,callback))}}:__webpack_require__(7)},function(module,exports,__webpack_require__){"use strict";module.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(module,exports,__webpack_require__){const bufferCoder=__webpack_require__(1);module.exports={open:function(){this.login(),this.joinGroup(),this.heartbeat()},error:function(err){},close:function(){this.logout()},message:async function(data){let m=data;"undefined"!=typeof MessageEvent&&(m=await bufferCoder.blob2ab(data.data));let r=await this.getMessage(m);Object.keys(this.messageEvent).filter(v=>!this.ignore.includes(v)).includes(r.type)&&this.messageEvent[r.type](r)}}},function(module,exports,__webpack_require__){(function(global){!function(l){function m(){}function k(b,a){if(b=void 0===b?"utf-8":b,a=void 0===a?{fatal:!1}:a,-1==n.indexOf(b.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+b+"') is invalid.");if(a.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}if(l.TextEncoder&&l.TextDecoder)return!1;var n=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(m.prototype,"encoding",{value:"utf-8"}),m.prototype.encode=function(b,a){if((a=void 0===a?{stream:!1}:a).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");a=0;for(var g=b.length,f=0,c=Math.max(32,g+(g>>1)+7),e=new Uint8Array(c>>3<<3);a<g;){var d=b.charCodeAt(a++);if(55296<=d&&56319>=d){if(a<g){var h=b.charCodeAt(a);56320==(64512&h)&&(++a,d=((1023&d)<<10)+(1023&h)+65536)}if(55296<=d&&56319>=d)continue}if(f+4>e.length&&(c+=8,c=(c*=1+a/b.length*2)>>3<<3,(h=new Uint8Array(c)).set(e),e=h),0==(4294967168&d))e[f++]=d;else{if(0==(4294965248&d))e[f++]=d>>6&31|192;else if(0==(4294901760&d))e[f++]=d>>12&15|224,e[f++]=d>>6&63|128;else{if(0!=(4292870144&d))continue;e[f++]=d>>18&7|240,e[f++]=d>>12&63|128,e[f++]=d>>6&63|128}e[f++]=63&d|128}}return e.slice?e.slice(0,f):e.subarray(0,f)},Object.defineProperty(k.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(k.prototype,"fatal",{value:!1}),Object.defineProperty(k.prototype,"ignoreBOM",{value:!1}),k.prototype.decode=function(b,a){if((a=void 0===a?{stream:!1}:a).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");b.buffer instanceof ArrayBuffer&&(b=b.buffer),b=new Uint8Array(b),a=0;for(var g=[],f=[];;){var c=a<b.length;if(!c||65536&a){if(f.push(String.fromCharCode.apply(null,g)),!c)return f.join("");g=[],b=b.subarray(a),a=0}if(0===(c=b[a++]))g.push(0);else if(0==(128&c))g.push(c);else if(192==(224&c)){var e=63&b[a++];g.push((31&c)<<6|e)}else if(224==(240&c)){e=63&b[a++];var d=63&b[a++];g.push((31&c)<<12|e<<6|d)}else if(240==(248&c)){65535<(c=(7&c)<<18|(e=63&b[a++])<<12|(d=63&b[a++])<<6|63&b[a++])&&(c-=65536,g.push(c>>>10&1023|55296),c=56320|1023&c),g.push(c)}}},l.TextEncoder=m,l.TextDecoder=k}("undefined"!=typeof window?window:void 0!==global?global:this)}).call(this,__webpack_require__(10))},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){__webpack_require__(0);module.exports={loginres:function(r){},chatmsg:function(r){},uenter:function(r){},upgrade:function(r){},rss:function(r){},bc_buy_deserve:function(r){},ssd:function(r){},spbc:function(r){},dgb:function(r){},onlinegift:function(r){},ggbb:function(r){},rankup:function(r){},ranklist:function(r){}}}]);