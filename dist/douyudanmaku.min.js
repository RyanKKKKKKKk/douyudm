!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=6)}([function(module,exports){function Util(){["Object","Array","String","Number","Boolean","Function","RegExp","Date","Undefined","Null","Symbol","Blob","ArrayBuffer"].forEach(type=>{this[`is${type}`]=(p=>Object.prototype.toString.call(p).slice(8,-1)===type)})}Util.prototype.isBrowser=(()=>"undefined"!=typeof window),Util.prototype.random=((min,max)=>Math.floor(Math.random()*(max-min+1)+min)),Util.prototype.download=((filename,text)=>{if(this.isBrowser()){let element=document.createElement("a");element.style.display="none";let blob=new Blob([text]);element.download=`${filename}.log`,element.href=URL.createObjectURL(blob),document.body.appendChild(element),element.click(),URL.revokeObjectURL(blob),document.body.removeChild(element)}}),module.exports=new Util},function(module,exports,__webpack_require__){"use strict";const danmaku=__webpack_require__(7);danmaku.stt=__webpack_require__(4),danmaku.util=__webpack_require__(0),danmaku.Websocket=__webpack_require__(5),module.exports=danmaku},function(module,exports,__webpack_require__){const URL=`wss://danmuproxy.douyu.com:${8500+__webpack_require__(0).random(1,6)}/`;module.exports={URL:URL,HEARBEAT_INTERVAL:45,MSG_LIVE_ON:"\u4e3b\u64ad\u6b63\u5728\u76f4\u64ad",MSG_LIVE_OFF:"\u4e3b\u64ad\u6ca1\u6709\u76f4\u64ad",MSG_ROOM_RSS:"\u623f\u95f4\u5f00\u64ad\u63d0\u9192",MSG_BC_BUY_DESERVE:"\u8d60\u9001\u916c\u52e4\u901a\u77e5",MSG_SSD:"\u8d85\u7ea7\u5f39\u5e55",MSG_ROOM_SPBC:"\u623f\u95f4\u5185\u793c\u7269\u5e7f\u64ad"}},function(module,exports,__webpack_require__){function BufferCoder(){this.buffer=new ArrayBuffer(0),this.decoder=new TextDecoder,this.encoder=new TextEncoder,this.littleEndian=!0,this.readLength=0}__webpack_require__(9),BufferCoder.prototype.concat=function(){const arr=[];for(let n=0;n<arguments.length;n++)arr[n]=arguments[n];return arr.reduce(function(arr,buf){const message=buf instanceof ArrayBuffer?new Uint8Array(buf):buf,t=new Uint8Array(arr.length+message.length);return t.set(arr,0),t.set(message,arr.length),t},new Uint8Array(0))},BufferCoder.prototype.decode=function(buf,callback,LE){for(LE=LE||this.littleEndian,this.buffer=this.concat(this.buffer,buf).buffer;this.buffer&&this.buffer.byteLength>0;){if(0===this.readLength){if(this.buffer.byteLength<4)return;this.readLength=new DataView(this.buffer).getUint32(0,LE),this.buffer=this.buffer.slice(4)}if(this.buffer.byteLength<this.readLength)return;const str=this.decoder.decode(this.buffer.slice(8,this.readLength-1));this.buffer=this.buffer.slice(this.readLength),this.readLength=0,callback(str)}},BufferCoder.prototype.encode=function(str,LE){LE=LE||this.littleEndian;let message=this.concat(this.encoder.encode(str),Uint8Array.of(0)),len=8+message.length,r=new DataView(new ArrayBuffer(len+4)),offset=0;return r.setUint32(offset,len,LE),offset+=4,r.setUint32(offset,len,LE),offset+=4,r.setInt16(offset,689,LE),offset+=2,r.setInt8(offset,0),offset+=1,r.setInt8(offset,0),offset+=1,new Uint8Array(r.buffer).set(message,offset),r.buffer},BufferCoder.prototype.blob2ab=function(blob){return new Promise((resolve,reject)=>{let reader=new FileReader;reader.onload=function(e){resolve(e.target.result)},reader.readAsArrayBuffer(blob)})},BufferCoder.prototype.ab2blob=function(ab){return new Blob([ab])},module.exports=new BufferCoder},function(module,exports,__webpack_require__){const util=__webpack_require__(0);function escape(value){return value=(value=(value=value.toString()).replace(/@/g,"@A")).replace(/\//g,"@S")}module.exports={serialize:function serialize(data){if(util.isObject(data)){let str="";for(let[key,value]of Object.entries(data))str+=`${escape(serialize(key))}@=${escape(serialize(value))}/`;return str}return util.isArray(data)?data.map(value=>`${escape(serialize(value))}/`).join(""):util.isString(data)||util.isNumber(data)?data.toString():""},deserialize:function deserialize(raw){const result={};if(util.isUndefined(result)||raw.length<=0)return result;let arr=raw.split("/");for(let i=arr.length-2;i>=0;i--){let item=arr[i].split("@="),k=item[0],v=item[1];/^\w+@A=(.*?)@S$/.test(v)&&(v=deserialize(v.toString().replace(/@A/g,"@").replace(/@S/g,"/"))),result[k]=v}return result}}},function(module,exports,__webpack_require__){const util=__webpack_require__(0);module.exports=util.isBrowser()?class{constructor(address){this.listener={},this.socket=new WebSocket(address)}send(data){this.socket.send(data)}close(code,reason){this.socket.close(code,reason)}on(method,callback){let eventName=["open","error","close","message"].find(event=>event===method.toLocaleLowerCase());eventName&&(Object.keys(this.listener).includes(eventName)&&this.socket.removeEventListener(eventName,this.listener[eventName]),this.listener[eventName]=callback,this.socket.addEventListener(eventName,callback))}}:__webpack_require__(14)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var douyudm__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),douyudm__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(douyudm__WEBPACK_IMPORTED_MODULE_0__);window.douyudanmaku=douyudm__WEBPACK_IMPORTED_MODULE_0___default.a,window.danmaku=douyudm__WEBPACK_IMPORTED_MODULE_0___default.a},function(module,exports,__webpack_require__){const config=__webpack_require__(2),event=__webpack_require__(8),stt=__webpack_require__(4),util=__webpack_require__(0),bufferCoder=__webpack_require__(3),messageEvent=__webpack_require__(13);module.exports=class{constructor(roomId,opts){this.roomId=roomId,this.ws=null,this.heartbeatTask=null,this.messageEvent=messageEvent,this.ignore=[],this.options=this.setOptions(opts||{}),this.clientEvent={connect:{name:"open",listener:event.open},disconnect:{name:"close",listener:event.close},error:{name:"error",listener:event.error}}}initSocket(ws){this.ws=new ws(config.URL),this.ws.on("open",this.clientEvent.connect.listener.bind(this)),this.ws.on("error",this.clientEvent.error.listener.bind(this)),this.ws.on("close",this.clientEvent.disconnect.listener.bind(this)),this.ws.on("message",event.message.bind(this))}send(message){this.ws.send(bufferCoder.encode(stt.serialize(message)))}getMessage(data){return new Promise((resolve,reject)=>{bufferCoder.decode(data,e=>{resolve(stt.deserialize(e))})})}login(){this.send({type:"loginreq",roomid:this.roomId})}joinGroup(){this.send({type:"joingroup",rid:this.roomId,gid:0})}heartbeat(){this.heartbeatTask=setInterval(()=>{this.send({type:"mrkl"})},1e3*config.HEARBEAT_INTERVAL)}logout(){this.send({type:"logout"}),clearInterval(this.heartbeatTask),this.ws.close()}run(websocket){let ws=websocket||__webpack_require__(5);this.initSocket(ws)}setIgnore(key,value){if(util.isObject(key))for(let i in key)key[i]&&this.ignore.push(i);else value&&this.ignore.push(key);return this}setOptions(opts){const defOpts={debug:!1,logfile:`${this.roomId}.log`},options={};return util.isObject(opts)?(opts.hasOwnProperty("debug")&&util.isBoolean(opts.debug)&&(options.debug=opts.debug),opts.hasOwnProperty("logfile")&&util.isString(opts.logfile)&&(options.logfile=opts.logfile),Object.assign(defOpts,options)):defOpts}on(method,callback){let clientEventName=Object.keys(this.clientEvent).find(clientEvent=>clientEvent===method.toLocaleLowerCase());if(clientEventName){if("connect"===clientEventName){let cb=callback;callback=function(res){this.login(),this.joinGroup(),this.heartbeat(),cb.bind(this)(res)}}else if("disconnect"===clientEventName){let cb=callback;callback=function(res){this.logout(),cb.bind(this)(res)}}this.clientEvent[method].listener=callback.bind(this)}Object.keys(this.messageEvent).find(messageEvent=>messageEvent===method.toLocaleLowerCase())&&(this.messageEvent[method]=callback.bind(this))}}},function(module,exports,__webpack_require__){const bufferCoder=__webpack_require__(3),util=__webpack_require__(0),logger=__webpack_require__(11);module.exports={open:function(){this.login(),this.joinGroup(),this.heartbeat()},error:function(err){},close:function(){this.logout()},message:async function(data){let m=data;"undefined"!=typeof MessageEvent&&(m=await bufferCoder.blob2ab(data.data));let r=await this.getMessage(m);if(Object.keys(this.messageEvent).filter(v=>!this.ignore.includes(v)).includes(r.type)&&this.messageEvent[r.type](r),this.options.debug){const dbname=util.isBrowser()?this.roomId:this.options.logfile;new logger(dbname).echo(r)}}}},function(module,exports,__webpack_require__){(function(global){!function(l){function m(){}function k(c,a){if(c=void 0===c?"utf-8":c,a=void 0===a?{fatal:!1}:a,-1===n.indexOf(c.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+c+"') is invalid.");if(a.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}if(l.TextEncoder&&l.TextDecoder)return!1;var n=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(m.prototype,"encoding",{value:"utf-8"}),m.prototype.encode=function(c,a){if((a=void 0===a?{stream:!1}:a).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");a=0;for(var g=c.length,f=0,b=Math.max(32,g+(g>>1)+7),e=new Uint8Array(b>>3<<3);a<g;){var d=c.charCodeAt(a++);if(55296<=d&&56319>=d){if(a<g){var h=c.charCodeAt(a);56320==(64512&h)&&(++a,d=((1023&d)<<10)+(1023&h)+65536)}if(55296<=d&&56319>=d)continue}if(f+4>e.length&&(b+=8,b=(b*=1+a/c.length*2)>>3<<3,(h=new Uint8Array(b)).set(e),e=h),0==(4294967168&d))e[f++]=d;else{if(0==(4294965248&d))e[f++]=d>>6&31|192;else if(0==(4294901760&d))e[f++]=d>>12&15|224,e[f++]=d>>6&63|128;else{if(0!=(4292870144&d))continue;e[f++]=d>>18&7|240,e[f++]=d>>12&63|128,e[f++]=d>>6&63|128}e[f++]=63&d|128}}return e.slice?e.slice(0,f):e.subarray(0,f)},Object.defineProperty(k.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(k.prototype,"fatal",{value:!1}),Object.defineProperty(k.prototype,"ignoreBOM",{value:!1}),k.prototype.decode=function(c,a){if((a=void 0===a?{stream:!1}:a).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");!((a=c)instanceof Uint8Array)&&a.buffer instanceof ArrayBuffer&&(a=new Uint8Array(c.buffer)),c=0;for(var g=[],f=[];;){var b=c<a.length;if(!b||65536&c){if(f.push(String.fromCharCode.apply(null,g)),!b)return f.join("");g=[],a=a.subarray(c),c=0}if(0===(b=a[c++]))g.push(0);else if(0==(128&b))g.push(b);else if(192==(224&b)){var e=63&a[c++];g.push((31&b)<<6|e)}else if(224==(240&b)){e=63&a[c++];var d=63&a[c++];g.push((31&b)<<12|e<<6|d)}else if(240==(248&b)){65535<(b=(7&b)<<18|(e=63&a[c++])<<12|(d=63&a[c++])<<6|63&a[c++])&&(b-=65536,g.push(b>>>10&1023|55296),b=56320|1023&b),g.push(b)}}},l.TextEncoder=m,l.TextDecoder=k}("undefined"!=typeof window?window:void 0!==global?global:this)}).call(this,__webpack_require__(10))},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){const util=__webpack_require__(0),Logger=function(dbname){if(this.dbname=dbname,this.db=null,util.isBrowser()){window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;const sql=indexedDB.open("danmaku",1);sql.addEventListener("success",e=>{this.db=event.target.result}),sql.addEventListener("upgradeneeded",e=>{this.db=event.target.result,this.db.createObjectStore(this.dbname,{keyPath:"id",autoIncrement:!0})}),sql.addEventListener("error",e=>{})}};if(util.isBrowser())Logger.prototype.echo=function(data){this.db.transaction(this.dbname,"readwrite").objectStore(this.dbname).add({t:(new Date).getTime(),frame:data})},Logger.prototype.all=function(){const store=this.db.transaction(this.dbname,"readonly").objectStore(this.dbname);return new Promise(function(resolve,reject){const req=store.getAll();req.addEventListener("success",function(e){resolve(req.result)}),req.addEventListener("error",function(e){reject(!1)})})},Logger.prototype.len=function(){const store=this.db.transaction(this.dbname,"readonly").objectStore(this.dbname);return new Promise(function(resolve,reject){const req=store.count();req.addEventListener("success",function(e){resolve(req.result)}),req.addEventListener("error",function(e){reject(!1)})})},Logger.prototype.export=async function(){let text="";return(await this.all()).forEach((value,index)=>{text+=`${JSON.stringify({t:value.t,frame:value.frame})}\n`}),download(this.dbname,text),text};else{const fs=__webpack_require__(12);Logger.prototype.echo=function(data){fs.appendFile(this.dbname,JSON.stringify({t:(new Date).getTime(),frame:data})+"\n",function(err){})},Logger.prototype.all=function(){return new Promise((resolve,reject)=>{fs.readFile(this.dbname,"utf8",function(err,str){err?reject(err):resolve(str)})})},Logger.prototype.len=function(){return new Promise(async(resolve,reject)=>{resolve((await this.all()).split("\n").filter(v=>""!==v).length)})},Logger.prototype.export=function(){return fs.readFileSync(this.dbname,"utf8")}}module.exports=Logger},function(module,exports){},function(module,exports,__webpack_require__){__webpack_require__(2);module.exports={loginres:function(r){},chatmsg:function(r){},uenter:function(r){},upgrade:function(r){},rss:function(r){},bc_buy_deserve:function(r){},ssd:function(r){},spbc:function(r){},dgb:function(r){},onlinegift:function(r){},ggbb:function(r){},rankup:function(r){},ranklist:function(r){},mrkl:function(r){},erquizisn:function(r){},blab:function(r){},rri:function(r){},synexp:function(r){},noble_num_info:function(r){},gbroadcast:function(r){},qausrespond:function(r){},wiru:function(r){},wirt:function(r){},mcspeacsite:function(r){},rank_change:function(r){},srres:function(r){},anbc:function(r){}}},function(module,exports,__webpack_require__){"use strict";module.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}]);